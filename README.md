# 江南大学实验室设备管理系统

## 项目简介

江南大学实验室设备管理系统是一个用于管理实验室设备借用、预约和审批的Web应用系统。系统支持多种用户角色，包括学生、教师、校外人员、设备管理员和实验室负责人。

---

## 快速开始

### 第一步：安装Python（如果还没有）

1. 访问 https://www.python.org/downloads/
2. 下载Python 3.8或更高版本
3. 安装时**务必勾选**"Add Python to PATH"
4. 打开命令行（Windows按Win+R，输入cmd），输入 `python --version` 验证安装

### 第二步：安装项目依赖

1. 打开命令行，进入项目目录（假设项目在 `C:\Users\你的用户名\Equipment-Management-System`）
2. 输入以下命令安装依赖：

```bash
pip install -r requirements.txt
```

如果提示 `pip` 不是内部命令，尝试使用：
```bash
python -m pip install -r requirements.txt
```

### 第三步：初始化数据库

1. 在项目目录下，输入以下命令创建数据库表：

```bash
python manage.py migrate
```

这个命令会创建所有必需的数据表。

### 第四步：创建初始用户组和管理员账号

1. 输入以下命令创建用户组和初始管理员：

```bash
python init_groups.py
```

或者使用Django shell：

```bash
python manage.py shell
```

然后在shell中输入：
```python
exec(open('init_groups.py').read())
```

2. 系统会自动创建以下管理员账号：
   - **设备管理员**：用户名 `labadmin`，密码 `labadmin`
   - **实验室负责人**：用户名 `manager`，密码 `manager`

### 第五步：启动服务器

在项目目录下输入：

```bash
python manage.py runserver
```

看到以下信息表示启动成功：
```
Starting development server at http://127.0.0.1:8000/
Quit the server with CTRL-BREAK.
```

### 第六步：访问系统

打开浏览器，访问：**http://127.0.0.1:8000/**

---

##  用户角色说明（不支持多身份同时登录）

### 1. 普通用户（学生/教师/校外人员）

**注册方式：**
- 访问登录页面，点击"立即注册"
- 填写用户编号、姓名、密码等信息
- 选择用户类型（学生/教师/校外人员）
- **注意**：学生和校外人员注册后可直接登录，教师注册后需要等待管理员审核

**登录方式：**
- 用户名：用户编号/学号/工号
- 密码：注册时设置的密码（初始密码通常是用户编号）
- 角色：选择"普通用户（教师/学生/校外人员）"

**主要功能：**
- 查看设备列表和详情
- 提交设备预约申请
- 查看我的预约记录
- 修改个人信息和密码
- 教师可以审批学生的预约申请

### 2. 设备管理员

**登录方式：**（不支持多身份同时登录）
- 用户名：`labadmin`
- 密码：`labadmin`
- 角色：选择"设备管理员"

**主要功能：**
- 设备管理（添加、编辑、删除设备）
- 审批预约申请（学生、教师、校外人员）
- 查看设备台账记录
- 生成和导出报表（周报、月报、年报）
- 删除报表

### 3. 实验室负责人

**登录方式：**
- 用户名：`manager`
- 密码：`manager`
- 角色：选择"实验室负责人"

**主要功能：**
- 审批预约申请（校外人员需要负责人审批）
- 用户管理（审核新用户注册、编辑用户信息、禁用/启用用户）
- 查看设备台账记录
- 生成和导出报表（周报、月报、年报）
- 删除报表

---

##  详细使用说明（不支持多身份同时登录）

### 一、普通用户使用指南

#### 1.1 注册账号

1. 访问登录页面：http://127.0.0.1:8000/
2. 点击"还没有账号？立即注册"
3. 填写注册信息：
   - **用户编号**：你的学号/工号（学生填写学号，教师填写工号）
   - **姓名**：真实姓名
   - **密码**：设置登录密码
   - **确认密码**：再次输入密码
   - **用户类型**：选择"学生"、"教师"或"校外人员"
   - **专业**（仅学生）：填写专业名称
   - **邮箱**：可选
   - **电话**：可选
4. 点击"注册"按钮
5. 注册成功后：
   - **学生和校外人员**：可直接登录使用
   - **教师**：需要等待管理员审核，审核通过后才能登录

#### 1.2 登录系统

1. 访问登录页面
2. 输入用户名（用户编号/学号/工号）
3. 输入密码
4. **重要**：在"用户角色"下拉框中选择"普通用户（教师/学生/校外人员）"
5. 点击"登录系统"

#### 1.3 查看设备列表

1. 登录后，点击左侧菜单"设备列表"
2. 可以看到所有可用设备
3. 可以搜索设备名称
4. 点击设备名称查看详细信息

#### 1.4 提交预约申请

1. 点击左侧菜单"预约申请"
2. 选择要预约的设备
3. 选择预约日期（点击日期选择器）
4. 系统会自动显示该日期的可用时间段
5. 选择时间段（可以多选）
6. 填写预约用途说明
7. 如果是学生，需要选择指导教师
8. 点击"提交申请"
9. 提交后，状态显示为"待教师审批"（学生）或"待管理员审批"（教师/校外人员）

#### 1.5 查看我的预约

1. 点击左侧菜单"我的预约"
2. 可以看到所有你提交的预约记录
3. 状态说明：
   - **待教师审批**：等待指导教师审批（仅学生）
   - **待管理员审批**：等待设备管理员审批
   - **待负责人审批**：等待实验室负责人审批（仅校外人员）
   - **已通过**：预约已通过，可以使用设备
   - **已拒绝**：预约被拒绝
   - **已取消**：预约已取消
   - **已完成**：预约时间已过，使用完成

#### 1.6 修改个人信息

1. 点击左侧菜单"个人信息"
2. 可以修改姓名、邮箱、电话等信息
3. 点击"保存"按钮

#### 1.7 修改密码

1. 点击左侧菜单"修改密码"
2. 输入当前密码
3. 输入新密码
4. 确认新密码
5. 点击"修改密码"按钮

#### 1.8 教师审批学生预约（仅教师）

1. 点击左侧菜单"查看我的学生预约申请"
2. 可以看到所有分配给你的学生的预约申请
3. 可以按学生专业筛选
4. 点击"审批"按钮
5. 选择"通过"或"拒绝"
6. 填写审批意见（可选）
7. 点击"提交审批"

---

### 二、设备管理员使用指南

#### 2.1 登录系统

1. 访问登录页面
2. 用户名：`labadmin`
3. 密码：`labadmin`
4. **重要**：在"用户角色"下拉框中选择"设备管理员"
5. 点击"登录系统"

#### 2.2 设备管理

**添加设备：**
1. 点击左侧菜单"设备管理"
2. 点击"添加设备"按钮
3. 填写设备信息：
   - 设备名称（必填）
   - 设备编号（必填，唯一）
   - 设备类型
   - 设备状态：正常/维修中/已报废
   - 设备描述
4. 点击"保存"按钮

**编辑设备：**
1. 在设备列表中，点击设备名称或"编辑"按钮
2. 修改设备信息
3. 点击"保存"按钮

**删除设备：**
1. 在设备列表中，找到要删除的设备
2. 点击"删除"按钮
3. 确认删除

**修改设备状态：**
1. 在设备列表中，找到要修改的设备
2. 在"设备状态"下拉框中选择新状态
3. 点击"更新状态"按钮

**搜索设备：**
1. 在设备管理页面顶部，输入设备名称关键词
2. 点击"搜索"按钮

#### 2.3 审批预约申请

1. 点击左侧菜单"预约审批"
2. 可以看到所有待审批的预约申请
3. 可以按状态筛选（待审批/已通过/已拒绝）
4. 点击预约编号查看详情
5. 在详情页面：
   - 点击"通过"按钮批准预约
   - 点击"拒绝"按钮拒绝预约
   - 可以填写审批意见
6. 也可以批量审批：勾选多个预约，选择操作，点击"批量操作"

#### 2.4 查看设备台账

1. 点击左侧菜单"设备台账"
2. 可以看到所有设备操作记录
3. 可以按设备、用户、操作类型筛选
4. 点击记录查看详细信息

#### 2.5 生成报表

1. 点击左侧菜单"报表统计"
2. 选择报表类型：
   - **周报**：本周的设备使用情况
   - **月报**：本月的设备使用情况
   - **年报**：本年的设备使用情况
3. 选择日期范围（月报和年报）
4. 点击"生成报表"按钮
5. 报表生成后，可以：
   - 查看报表详情
   - 导出为Excel文件
   - 删除报表

---

### 三、实验室负责人使用指南

#### 3.1 登录系统

1. 访问登录页面
2. 用户名：`manager`
3. 密码：`manager`
4. **重要**：在"用户角色"下拉框中选择"实验室负责人"
5. 点击"登录系统"

#### 3.2 审批预约申请

1. 点击左侧菜单"预约审批"
2. 主要审批校外人员的预约申请（需要管理员和负责人双重审批）
3. 审批流程同设备管理员

#### 3.3 用户管理

**审核新用户注册（仅教师需要审核）：**
1. 点击左侧菜单"用户管理"
2. 可以看到所有用户列表
3. 找到状态为"待审核"的用户（通常是新注册的教师）
4. 点击"审批"按钮
5. 选择"通过"或"拒绝"
6. 点击"提交"
7. **注意**：学生和校外人员注册时自动通过，不需要审核

**编辑用户信息：**
1. 在用户列表中，点击用户姓名或"编辑"按钮
2. 可以修改用户信息（姓名、邮箱、电话等）
3. 可以修改用户状态（启用/禁用）
4. 点击"保存"按钮

**禁用/启用用户：**
1. 在用户列表中，找到要操作的用户
2. 点击"禁用"或"启用"按钮
3. 确认操作

**搜索用户：**
1. 在用户管理页面顶部，输入用户编号或姓名关键词
2. 点击"搜索"按钮

**批量导入学生：**
1. 点击左侧菜单"用户管理"
2. 点击"批量导入学生"按钮
3. 下载Excel模板
4. 按照模板格式填写学生信息
5. 上传Excel文件
6. 系统会自动创建学生账号

#### 3.4 查看设备台账

同设备管理员，参考"2.4 查看设备台账"

#### 3.5 生成报表

同设备管理员，参考"2.5 生成报表"

---

##  系统配置

### 数据库迁移

如果系统更新了数据模型，需要运行迁移：

```bash
python manage.py makemigrations
python manage.py migrate
```

### 定时任务配置（设备状态自动更新）

系统需要定期运行命令来更新设备状态（取消过期的预约）。

**Windows系统：**
1. 打开"任务计划程序"
2. 创建基本任务
3. 触发器：每10分钟
4. 操作：启动程序
5. 程序：`python`
6. 参数：`manage.py update_device_status`
7. 起始于：项目目录路径

**Linux系统：**
编辑crontab：
```bash
crontab -e
```

添加以下行：
```
*/10 * * * * cd /path/to/project && python manage.py update_device_status
```

### IP访问限制（可选）

如果需要限制工作人员只能从局域网访问：

1. 编辑 `jnu_lab_system/middleware.py`
2. 找到 `ENABLE_IP_RESTRICTION = False`
3. 改为 `ENABLE_IP_RESTRICTION = True`
4. 配置允许的IP地址段

---

## 常见问题

### Q1: 登录时提示"用户名或密码错误"

**解决方法：**
- 检查用户名是否正确（注意大小写）
- 检查密码是否正确
- **重要**：检查是否选择了正确的"用户角色"
- 如果是新注册的教师，检查是否已被管理员审核通过（学生和校外人员注册后可直接登录）

### Q2: 登录后显示"403 Forbidden"或权限不足

**解决方法：**
- 确认选择了正确的用户角色登录
- 确认账号已被管理员审核通过
- 如果是管理员/负责人，确认账号已分配到正确的用户组

### Q3: 预约申请提交后看不到可用时间段

**解决方法：**
- 检查是否选择了日期
- 检查该日期是否有可用时间段
- 刷新页面重试
- 检查设备状态是否为"正常"（不能预约维修中或已报废的设备）

### Q4: 设备状态显示不正确

**解决方法：**
- 设备状态分为两种：
  - **物理状态**：正常/维修中/已报废（由管理员设置）
  - **时间占用**：某个时间段已被预约
- 如果设备物理状态正常但显示不可用，可能是该时间段已被预约

### Q5: 报表生成失败

**解决方法：**
- 检查日期范围是否合理
- 检查是否有数据
- 查看系统日志

### Q6: 在同一浏览器打开多个角色会串身份

**解决方法：**
- 系统支持在同一浏览器同时登录多个角色
- 每个角色使用独立的session
- 如果出现身份混淆，清除浏览器缓存和Cookie后重试
- 确保每个标签页访问的是对应角色的URL（/user/、/labadmin/、/manager/）

---

## 系统要求

- **Python版本**：3.8或更高
- **Django版本**：5.2.9
- **数据库**：SQLite（默认，开发环境）或 PostgreSQL/MySQL（生产环境）
- **浏览器**：Chrome、Firefox、Edge等现代浏览器

---

##  技术支持

如遇到问题，请检查：
1. Python和Django版本是否正确
2. 是否运行了数据库迁移
3. 是否创建了初始用户组
4. 浏览器控制台是否有错误信息
5. Django服务器日志是否有错误信息

---

**版本**：1.0  
**最后更新**：2025年
