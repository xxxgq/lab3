{% extends 'base.html' %}

{% block title %}
    {% if device %}编辑设备 {{ device.device_code }} - 江南大学实验室设备管理系统{% else %}设备详情{% endif %}
{% endblock %}

{% block sidebar %}
<div class="sidebar">
    {% if is_admin %}
        {# 管理员侧边栏 #}
        <a href="{% url 'admin_home' %}">首页</a>
        <a href="{% url 'booking_approve' %}">预约审批</a>
        <a href="{% url 'device_manage' %}">设备管理</a>
        <a href="{% url 'ledger:ledger_home' %}">台账</a>
        <a href="{% url 'report_stat' %}">报表统计</a>
    {% elif is_manager %}
        {# 负责人侧边栏 #}
        <a href="{% url 'manager_home' %}">首页</a>
        <a href="{% url 'manager_booking_approve' %}">校外人员预约审批</a>
        <a href="{% url 'device_manage' %}">设备管理</a>
        <a href="{% url 'user_manage' %}">用户管理</a>
        <a href="{% url 'ledger:ledger_home' %}">台账</a>
        <a href="{% url 'manager_report_stat' %}">报表统计</a>
    {% else %}
        {# 默认侧边栏（不应该出现，但作为后备） #}
        <a href="{% url 'admin_home' %}">首页</a>
        <a href="{% url 'device_manage' %}">设备管理</a>
    {% endif %}
</div>
{% endblock %}

{% block content %}
<div class="card">
    <!-- 页面标题：设备编号 + 名称 -->
    <h2>设备详情 / 编辑</h2>
    <h3>{{ device.device_code }} - {{ device.name|default:device.model }}</h3>

    <!-- 设备详情概览（可选，增强体验） -->
    <div style="margin: 20px 0; padding: 10px; background-color: #f5f5f5; border-radius: 5px;">
        <p><strong>设备状态：</strong> 
            {% if device.status == 'available' %}
                <span style="color: green; font-weight: bold;">{{ device.get_status_display }}</span>
            {% elif device.status == 'maintenance' %}
                <span style="color: orange; font-weight: bold;">{{ device.get_status_display }}</span>
            {% elif device.status == 'discarded' %}
                <span style="color: #999; font-weight: bold;">{{ device.get_status_display }}</span>
            {% else %}
                <span>{{ device.get_status_display }}</span>
            {% endif %}
        </p>
        <p><strong>存放位置：</strong> 实验室设备管理系统（当前仅展示，后续可扩展）</p>
    </div>

    <!-- 设备编辑表单 -->
    <form method="post">
        {% csrf_token %}
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div class="form-group">
                <label>{{ form.device_code.label }}</label>
                {{ form.device_code }}
            </div>
            <div class="form-group">
                <label>{{ form.model.label }}</label>
                {{ form.model }}
            </div>
            <div class="form-group">
                <label>{{ form.manufacturer.label }}</label>
                {{ form.manufacturer }}
            </div>
            <div class="form-group">
                <label>{{ form.purchase_date.label }}</label>
                {{ form.purchase_date }}
            </div>
            <div class="form-group">
                <label>{{ form.purpose.label }}</label>
                {{ form.purpose }}
            </div>
            <div class="form-group">
                <label>{{ form.status.label }}</label>
                {{ form.status }}
            </div>
            <div class="form-group">
                <label>{{ form.price_internal.label }}</label>
                {{ form.price_internal }}
            </div>
            <div class="form-group">
                <label>{{ form.price_external.label }}</label>
                {{ form.price_external }}
            </div>
        </div>

        <div style="margin-top: 20px;">
            <button type="submit" class="btn btn-success" style="width: 120px; padding: 8px 0; display: inline-block; text-align: center;">保存修改</button>
            <a href="{% url 'device_manage' %}" class="btn btn-secondary" style="width: 120px; padding: 8px 0; display: inline-block; text-align: center; margin-left: 10px;">返回设备列表</a>
            <a href="{% url 'device_delete' pk=device.pk %}" class="btn btn-danger" style="width: 120px; padding: 8px 0; display: inline-block; text-align: center; margin-left: 10px;" onclick="return confirm('确定要删除设备【{{ device.device_code }}】吗？删除后数据不可恢复！')">删除设备</a>
        </div>
    </form>
</div>
{% endblock %}